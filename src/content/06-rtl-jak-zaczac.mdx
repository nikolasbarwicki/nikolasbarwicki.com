---
title: "React Testing Library - jak zacz"
slug: react-testing-library-jak-zaczac
date: 2021-05-16
category: react
published: true
---

### Wstp

Pisanie test贸w w na frontendzie nie jest tak powszechn praktyk jak w przypadku programist贸w backendowych. W wielu projektach testy **nie s stosowane wcale** lub s stosowane w niewaciwy spos贸b.

Wielu programist贸w postrzega testy jako obci偶enie i co co zabiera im czas przez co wolniej dowo偶 kod. Pozostali, kt贸rym udao si przekona do testowania czsto uwa偶a, 偶e jest **praktycznie odwrotnie**.

Otestowany kod **oszczedza nam czas** na manualnym przeklikiwaniu si przez nasz aplikacj czy sprawdzaniu _edge case'贸w_ przy **zmianach kodu**.

G贸wnym zadaniem pisania test贸w jest zagwarantowanie programicie, 偶e tworzona przez niego aplikacja zachowuje si w **oczekiwany przez nas spos贸b** w momencie, kiedy korzysta z niej u偶ytkownik. Ponadto testy powinny dawa nam pewno, 偶e dodawanie nowych funkcjonalnoci do tych ju偶 istniejcych **nie zepsuje tego co ju偶 dziaao** bez zarzut贸w.

### React Testing Library

W tej serii wpis贸w bd porusza kwestie zwizane z testowaniem przy u偶yciu **Jest i React Testing Library**. To poczenie jest obecnie najbardziej powszechne w wiecie Reakta, a fakt, 偶e dostajemy je _out of the box_ wraz z create-react-app te偶 wiadczy o jego og贸lnym uznaniu.

React Testing Library (RTL) nie jest tylko bibliotek - jest tak偶e ca **filozofi testowania** i **zbiorem najlepszych praktyk**. Spos贸b w jaki RTL zostaa stworzona niejako zachca nas do ich stosowania.

<Callout>
  The more your tests resemble the way your software is used, the more
  confidence they can give you.

Kent C. Dodds

</Callout>

**Kent - tw贸rca Testing Library** - chce nas przekona, 偶eby testowa dziaanie aplikacji w taki spos贸b w jaki robiby to jej kocowy u偶ytkownik. Spos贸b w jaki dana funkcjonalno zostaa napisana mo偶e si zmienia wraz z rozwojem aplikacji. Pod warunkiem zachowania staej, speniajcej zao偶enia funkcjonalnoci aplikacji testy nadal powinny przechodzi.

Ponadto, kolejn dobr praktyk jest pisanie naszych aplikacji zgodnie z zasadami dostpnoci (_ang. accessibility_). Testing Library zachca do wyszukiwania wz贸w DOM poprzez _accessibillity markers_ - w przypadku kiedy nasza aplikacja ich nie posiada lub s 藕le zaimplementowane - nie jestemy w stanie dobrze napisa test贸w, a co gorsze - osoby niepenosprawne lub korzystajce z czytnik贸w, innych urzdze mobilnych nie mog korzysta z naszej aplikacji we waciwy spos贸b.

### create-react-app

Po stworzeniu nowej aplikacji przy pomocy `create-react-app` naszym oczom ukazuje si wiele plik贸w w folderze projektu. Obecnie interesuje nas jedynie _App.test.js._

Jest szuka trzech rodzaj贸w plik贸w zawierajcych testy:

- pliki z suffixem `.js` w folderze `__tests__`
- pliki z suffixem `.test.js`
- pliki z suffixem `.spec.js`

Zalecane jest umieszczanie plik贸w z testami (lub folder贸w `__tests__`) w bezporednim ssiedztwie kodu, kt贸ry maj testowa - tak aby relatywne cie偶ki import贸w byy jak najkr贸tsze.

Wpisane w oknie terminalu `npm test` uruchamia Jest w trybie _watch_. Tryb ten powoduje, 偶e Jest wyszukuje zmian w plikach wzgldem ostatniego _commit'u_.

Po wykonaniu `npm test` - jeli nic nie zmienialimy w plikach dostarczonych przez _create-react-app_ powinnimy otrzyma potwierdzenie pomylnego zaliczenia testu znajdujcego si w pliku _App.test.js._

### Nasz pierwszy test

```jsx
import { render, screen } from "@testing-library/react"
import App from "./App"

test("renders learn react link", () => {
  render(<App />)
  const linkElement = screen.getByText(/learn react/i)
  expect(linkElement).toBeInTheDocument()
})
```

Przeanalizujmy ka偶dy z element贸w naszego testu po kolei.

Zaczynamy od import贸w. Zrozumienie z jakiej biblioteki importujemy jakie elementy bardzo uatwia odnalezienie si w caym ekosystemie testowania.

```jsx
// importujemy metody render i screen z RTL, ich wykorzystanie zostanie opisane ni偶ej
import { render, screen } from "@testing-library/react"
// importujemy komponent/y, kt贸re zamierzamy testowa w tym pliku
import App from "./App"
```

Globalna metoda testu przyjmujca dwa argumenty:

- opis testu bdcy zwykym _stringiem_. Pozwala nam lepiej rozumie, kt贸re testy przechodz, a kt贸re wrcz przeciwnie

```jsx
test("renders learn react link", () => {})
```

- funkcja testujca - zasada jej dziaania jest prosta - test nie przechodzi jeli w trakcie dziaania funkcji zostanie wyrzucony bd. Asercje wyrzucaj bd jeli zao偶enie testu nie zostanie spenione. Wniosek: brak bdu - test zaliczony.

```jsx
// zgodnie z tym wnioskiem - test przejdzie
test("renders learn react link", () => {})

// ten test nie przejdzie
test("renders learn react link", () => {
  throw new Error("test failed")
})
```

### Trzy fazy testowania komponentu

**Wynderowanie komponentu**

```jsx
render(<App />)
```

Metoda `render` tworzy wirtualny DOM dla argumentu - w tym przypadku `<App />`

**Odnalezienie elementu w DOM**

```jsx
const linkElement = screen.getByText(/learn react/i)
```

`screen` pochodzce r贸wnie偶 z \*Testing Library **\***pozwala nam "wyjmowa" interesujce nas elementy z DOM. `screen.getByText` wyszukuje element w DOM po wywietlanym tekcie. Mo偶e przyj za argument _stringa_ - "Learn React" ale zalecane jest stosowanie _regular expression_. W tym przypadku flaga `/i` dodaje nam ignorowanie wielkoci liter.

**Interakcja z elementem**
Ta cz jest opcjonalna. W tym miejscu mo偶emy np. zasymulowa interakcje u偶ytkownika - kliknicie na element, najechanie na niego kursorem lub wpisanie tekstu do inputu.

**Sprawdzenie czy UI jest w oczekiwanym przez nas stanie - asercja (_ang. assertion_)**

```jsx
expect(screen.getByText(heading)).toBeInTheDocument()
```

W tym miejscu dzieje si caa magia testu - ta linijka decyduje o tym czy test przejdzie czy te偶 nie. W przypadku zmiany argumentu `screen.getByText` z `/learn react/i` na `/learn angular/i` test nie przejdzie - to chyba podw贸jnie dobrze w takie sytuacji .

### RTL, Jest, JestDOM, Dom Testing Library

Na samym pocztku wiele os贸b zbyt szybko wchodzi w pisanie test贸w nie zastanawiajc si skd tak naprawd importuje poszczeg贸lne elementy i jak je poprawnie wykorzystywa. Poni偶ej wypisaem wszystkie g贸wne skadowe, kt贸re bdziemy wykorzystywa podczas pisania test贸w.

**React Testing Library** - renderuje komponenty do wirtualnego DOM, przeszukuje wirtualny DOM pozwala na wchodzenie w interakcj z wirtualnym DOM. Wymaga _test runnera_, kt贸ry odszuka testy, uruchomi je i sprawdzi asercje (Jest, Mocha, Jasmine). Zbudowane na podstawie Dom Testing Library - zawiera wszystko co DTL oraz posiada dodane metody _render, cleanup_ i _act_.

**Jest** - test runner - odszukuje, uruchamia i sprawdza czy testy przechodz. Dostarcza m. in. metod `expect()`.

**Jest DOM** - uzupenia React Testing Library - dodaje nowe matchery do Jest'a: `toBeDisabled()`, `toBeEmpty()`, `toBeInTheDocument()`, `toBeRequired()`, `teBeVisible()`, `toHaveValue()`. Domylnie zawarty w _create-react-app_. Importowany jest przed ka偶dym testem w pliku `src/setupTests.js`.

**Dom Testing Library** - biblioteka su偶ca do testowania wz贸w DOM - daje nam mo偶liwo znajdowania element贸w w spos贸b podobny do tego w jaki zrobiby to u偶ytkownik na stronie np. `getByText`, `getByRole`, `getByLabelText`, `getByPlaceholderText`.

### Podsumowanie

Wpis zd偶y urosn do konkretnych rozmiar贸w, a nie udao si napisa jeszcze ani jednego testu. Potwierdza to, 偶e wiat test贸w jest bardzo rozlegy. W kolejnych wpisach porusz tematy, kt贸rych znajomo pozwoli nam na testowanie zo偶onych aplikacji Reaktowych.
